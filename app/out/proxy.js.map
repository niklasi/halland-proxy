{"version":3,"sources":["../src/proxy.js"],"names":["http","require","url","net","module","exports","proxy","createServer","request","response","options","hostname","headers","host","method","path","proxyRequest","on","proxyResponse","pipe","req","cltSocket","head","srvUrl","parse","srvSocket","connect","port","write"],"mappings":"AAAA,MAAMA,OAAOC,QAAQ,MAAR,CAAb;AACA,MAAMC,MAAMD,QAAQ,KAAR,CAAZ;AACA,MAAME,MAAMF,QAAQ,KAAR,CAAZ;;AAEAG,OAAOC,OAAP,GAAiB,MAAM;AACrB,SAAOC,KAAP;AACD,CAFD;;AAIA,MAAMA,QAAQN,KAAKO,YAAL,CAAkB,UAAUC,OAAV,EAAmBC,QAAnB,EAA6B;AAC3D,MAAIC,UAAU;AACZC,cAAUH,QAAQI,OAAR,CAAgBC,IADd;AAEZC,YAAQN,QAAQM,MAFJ;AAGZF,aAASJ,QAAQI,OAHL;AAIZG,UAAMP,QAAQN;AAJF,GAAd;;AAOA,MAAIc,eAAehB,KAAKQ,OAAL,CAAaE,OAAb,CAAnB;AACAM,eAAaC,EAAb,CAAgB,UAAhB,EAA4B,UAAUC,aAAV,EAAyB;AACnDA,kBAAcC,IAAd,CAAmBV,QAAnB;AACD,GAFD;AAGAD,UAAQW,IAAR,CAAaH,YAAb;AACD,CAba,CAAd;;AAeAV,MAAMW,EAAN,CAAS,SAAT,EAAoB,CAACG,GAAD,EAAMC,SAAN,EAAiBC,IAAjB,KAA0B;AAC5C,MAAIC,SAASrB,IAAIsB,KAAJ,CAAW,YAAUJ,IAAIlB,GAAI,GAA7B,CAAb;AACA,MAAIuB,YAAYtB,IAAIuB,OAAJ,CAAYH,OAAOI,IAAnB,EAAyBJ,OAAOZ,QAAhC,EAA0C,MAAM;AAC9DU,cAAUO,KAAV,CAAgB,4CACd,gCADc,GAEd,MAFF;AAGAH,cAAUG,KAAV,CAAgBN,IAAhB;AACAG,cAAUN,IAAV,CAAeE,SAAf;AACAA,cAAUF,IAAV,CAAeM,SAAf;AACD,GAPe,CAAhB;AAQD,CAVD","file":"proxy.js","sourcesContent":["const http = require('http')\nconst url = require('url')\nconst net = require('net')\n\nmodule.exports = () => {\n  return proxy\n}\n\nconst proxy = http.createServer(function (request, response) {\n  var options = {\n    hostname: request.headers.host,\n    method: request.method,\n    headers: request.headers,\n    path: request.url\n  }\n\n  var proxyRequest = http.request(options)\n  proxyRequest.on('response', function (proxyResponse) {\n    proxyResponse.pipe(response)\n  })\n  request.pipe(proxyRequest)\n})\n\nproxy.on('connect', (req, cltSocket, head) => {\n  var srvUrl = url.parse(`https://${req.url}`)\n  var srvSocket = net.connect(srvUrl.port, srvUrl.hostname, () => {\n    cltSocket.write('HTTP/1.1 200 Connection Established\\r\\n' +\n      'Proxy-agent: Halland-Proxy\\r\\n' +\n      '\\r\\n')\n    srvSocket.write(head)\n    srvSocket.pipe(cltSocket)\n    cltSocket.pipe(srvSocket)\n  })\n})\n"]}